<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Consume Records with Subscriptions | HStreamDB Documentation</title><meta name="generator" content="VuePress 1.9.5"><link rel="shortcut icon" type="image/x-icon" href="/docs/docs-images/favicon-hstreamdb.ico"><link rel="stylesheet" href="https://at.alicdn.com/t/font_3137465_33anb3gl4nt.css"><script charset="utf-8" src="https://at.alicdn.com/t/font_3125249_pld7abubdat.js"></script><link rel="canonical" href="https://hstream.io/docs/en/latest/guides/consume.html"><meta name="docsearch:language" content="en"><meta name="docsearch:product" content="hstreamdb"><meta name="docsearch:version" content="latest"><meta name="description" content=""><meta property="og:site_name" content="HStreamDB Documentation"><meta property="og:title" content="Consume Records with Subscriptions"><meta property="og:type" content="website"><meta property="og:url" content="https://hstream.io/docs/en/latest/guides/consume.html"><meta name="twitter:title" content="Consume Records with Subscriptions"><meta name="twitter:url" content="https://hstream.io/docs/en/latest/guides/consume.html"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@EMQTech"><meta name="twitter:creator" content="@EMQTech"><meta name="twitter:image" content="https://www.emqx.com/images/logo_512.png"><meta name="twitter:image:alt" content="EMQ LOGO"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta property="og:image" content="https://www.emqx.com/images/logo_512.png"><link rel="preload" href="/docs/docs-assets/css/0.styles.ec078ccc.css" as="style"><link rel="preload" href="/docs/docs-assets/js/app.03bf0ac1.js" as="script"><link rel="preload" href="/docs/docs-assets/js/2.64e3e103.js" as="script"><link rel="preload" href="/docs/docs-assets/js/28.01df18f1.js" as="script"><link rel="prefetch" href="/docs/docs-assets/js/10.332ffeae.js"><link rel="prefetch" href="/docs/docs-assets/js/100.16056d16.js"><link rel="prefetch" href="/docs/docs-assets/js/101.d109d899.js"><link rel="prefetch" href="/docs/docs-assets/js/102.c08e1936.js"><link rel="prefetch" href="/docs/docs-assets/js/103.7c9419ec.js"><link rel="prefetch" href="/docs/docs-assets/js/104.38e3441b.js"><link rel="prefetch" href="/docs/docs-assets/js/105.8254f60a.js"><link rel="prefetch" href="/docs/docs-assets/js/106.87f2a073.js"><link rel="prefetch" href="/docs/docs-assets/js/107.0ee52fcc.js"><link rel="prefetch" href="/docs/docs-assets/js/108.2a82a131.js"><link rel="prefetch" href="/docs/docs-assets/js/109.d6cd23d5.js"><link rel="prefetch" href="/docs/docs-assets/js/11.5840f0c1.js"><link rel="prefetch" href="/docs/docs-assets/js/110.9f7a670c.js"><link rel="prefetch" href="/docs/docs-assets/js/111.8a733797.js"><link rel="prefetch" href="/docs/docs-assets/js/112.3e8bb67c.js"><link rel="prefetch" href="/docs/docs-assets/js/113.43f17717.js"><link rel="prefetch" href="/docs/docs-assets/js/12.8c3d4e85.js"><link rel="prefetch" href="/docs/docs-assets/js/13.3581377d.js"><link rel="prefetch" href="/docs/docs-assets/js/14.defa88b2.js"><link rel="prefetch" href="/docs/docs-assets/js/15.68fdb2b2.js"><link rel="prefetch" href="/docs/docs-assets/js/16.e21697ca.js"><link rel="prefetch" href="/docs/docs-assets/js/17.cea5ddd3.js"><link rel="prefetch" href="/docs/docs-assets/js/18.3d53a549.js"><link rel="prefetch" href="/docs/docs-assets/js/19.902a62f7.js"><link rel="prefetch" href="/docs/docs-assets/js/20.5b0040ce.js"><link rel="prefetch" href="/docs/docs-assets/js/21.d7b55b31.js"><link rel="prefetch" href="/docs/docs-assets/js/22.a45d14f0.js"><link rel="prefetch" href="/docs/docs-assets/js/23.5d53005f.js"><link rel="prefetch" href="/docs/docs-assets/js/24.888f1dea.js"><link rel="prefetch" href="/docs/docs-assets/js/25.91e21659.js"><link rel="prefetch" href="/docs/docs-assets/js/26.6810c6c1.js"><link rel="prefetch" href="/docs/docs-assets/js/27.3363c682.js"><link rel="prefetch" href="/docs/docs-assets/js/29.440d3a52.js"><link rel="prefetch" href="/docs/docs-assets/js/3.e5ef1dad.js"><link rel="prefetch" href="/docs/docs-assets/js/30.fcaf5e63.js"><link rel="prefetch" href="/docs/docs-assets/js/31.136e5c8e.js"><link rel="prefetch" href="/docs/docs-assets/js/32.61ed1e7b.js"><link rel="prefetch" href="/docs/docs-assets/js/33.73a92377.js"><link rel="prefetch" href="/docs/docs-assets/js/34.1e37cfa2.js"><link rel="prefetch" href="/docs/docs-assets/js/35.3c24d563.js"><link rel="prefetch" href="/docs/docs-assets/js/36.983abe56.js"><link rel="prefetch" href="/docs/docs-assets/js/37.306fd207.js"><link rel="prefetch" href="/docs/docs-assets/js/38.60684672.js"><link rel="prefetch" href="/docs/docs-assets/js/39.2e7538de.js"><link rel="prefetch" href="/docs/docs-assets/js/4.774ab83f.js"><link rel="prefetch" href="/docs/docs-assets/js/40.5da7bfe4.js"><link rel="prefetch" href="/docs/docs-assets/js/41.81eaaf1b.js"><link rel="prefetch" href="/docs/docs-assets/js/42.95b86204.js"><link rel="prefetch" href="/docs/docs-assets/js/43.6e5a07b6.js"><link rel="prefetch" href="/docs/docs-assets/js/44.cd3ef721.js"><link rel="prefetch" href="/docs/docs-assets/js/45.166a17c2.js"><link rel="prefetch" href="/docs/docs-assets/js/46.70cf324f.js"><link rel="prefetch" href="/docs/docs-assets/js/47.60a738a8.js"><link rel="prefetch" href="/docs/docs-assets/js/48.05563a1c.js"><link rel="prefetch" href="/docs/docs-assets/js/49.a1360c07.js"><link rel="prefetch" href="/docs/docs-assets/js/5.75b470dc.js"><link rel="prefetch" href="/docs/docs-assets/js/50.5b876480.js"><link rel="prefetch" href="/docs/docs-assets/js/51.85a096b5.js"><link rel="prefetch" href="/docs/docs-assets/js/52.8b04105a.js"><link rel="prefetch" href="/docs/docs-assets/js/53.18cf2963.js"><link rel="prefetch" href="/docs/docs-assets/js/54.14a26e63.js"><link rel="prefetch" href="/docs/docs-assets/js/55.1fecd4f3.js"><link rel="prefetch" href="/docs/docs-assets/js/56.743655ed.js"><link rel="prefetch" href="/docs/docs-assets/js/57.10e6e0b8.js"><link rel="prefetch" href="/docs/docs-assets/js/58.3a7dd49e.js"><link rel="prefetch" href="/docs/docs-assets/js/59.7ea6c3c1.js"><link rel="prefetch" href="/docs/docs-assets/js/6.a038a0d9.js"><link rel="prefetch" href="/docs/docs-assets/js/60.7f29c225.js"><link rel="prefetch" href="/docs/docs-assets/js/61.52137827.js"><link rel="prefetch" href="/docs/docs-assets/js/62.78f83393.js"><link rel="prefetch" href="/docs/docs-assets/js/63.c91cd75b.js"><link rel="prefetch" href="/docs/docs-assets/js/64.4c8f46eb.js"><link rel="prefetch" href="/docs/docs-assets/js/65.dd4eedbc.js"><link rel="prefetch" href="/docs/docs-assets/js/66.6e4369f2.js"><link rel="prefetch" href="/docs/docs-assets/js/67.b7e32d2c.js"><link rel="prefetch" href="/docs/docs-assets/js/68.4b250454.js"><link rel="prefetch" href="/docs/docs-assets/js/69.983d9d0f.js"><link rel="prefetch" href="/docs/docs-assets/js/7.e18cbbd5.js"><link rel="prefetch" href="/docs/docs-assets/js/70.5f36003d.js"><link rel="prefetch" href="/docs/docs-assets/js/71.c0503793.js"><link rel="prefetch" href="/docs/docs-assets/js/72.5a410209.js"><link rel="prefetch" href="/docs/docs-assets/js/73.958b0fc5.js"><link rel="prefetch" href="/docs/docs-assets/js/74.bf535945.js"><link rel="prefetch" href="/docs/docs-assets/js/75.f54f75db.js"><link rel="prefetch" href="/docs/docs-assets/js/76.0b0d654f.js"><link rel="prefetch" href="/docs/docs-assets/js/77.ea8a480a.js"><link rel="prefetch" href="/docs/docs-assets/js/78.6044f388.js"><link rel="prefetch" href="/docs/docs-assets/js/79.3bd21912.js"><link rel="prefetch" href="/docs/docs-assets/js/8.93881ee8.js"><link rel="prefetch" href="/docs/docs-assets/js/80.0600e5ea.js"><link rel="prefetch" href="/docs/docs-assets/js/81.00d5f693.js"><link rel="prefetch" href="/docs/docs-assets/js/82.fc69ab46.js"><link rel="prefetch" href="/docs/docs-assets/js/83.ff6c0a40.js"><link rel="prefetch" href="/docs/docs-assets/js/84.139f34c1.js"><link rel="prefetch" href="/docs/docs-assets/js/85.e52efa67.js"><link rel="prefetch" href="/docs/docs-assets/js/86.fbf398ed.js"><link rel="prefetch" href="/docs/docs-assets/js/87.955e3726.js"><link rel="prefetch" href="/docs/docs-assets/js/88.e7759aed.js"><link rel="prefetch" href="/docs/docs-assets/js/89.b99b2549.js"><link rel="prefetch" href="/docs/docs-assets/js/9.3a6a28a9.js"><link rel="prefetch" href="/docs/docs-assets/js/90.416dfa36.js"><link rel="prefetch" href="/docs/docs-assets/js/91.7c322383.js"><link rel="prefetch" href="/docs/docs-assets/js/92.79a4d44e.js"><link rel="prefetch" href="/docs/docs-assets/js/93.eddc78fa.js"><link rel="prefetch" href="/docs/docs-assets/js/94.833c041a.js"><link rel="prefetch" href="/docs/docs-assets/js/95.50d2c3fa.js"><link rel="prefetch" href="/docs/docs-assets/js/96.abd60e80.js"><link rel="prefetch" href="/docs/docs-assets/js/97.f1643e9f.js"><link rel="prefetch" href="/docs/docs-assets/js/98.7a2b4ac6.js"><link rel="prefetch" href="/docs/docs-assets/js/99.a07a2a16.js"><link rel="stylesheet" href="/docs/docs-assets/css/0.styles.ec078ccc.css"></head><body><div id="app" data-server-rendered="true"><div class="theme-container"><header id="app-header" class="is-clearfix is-hidden-mobile"><nav id="navbar" role="navigation" aria-label="main navigation" class="navbar is-relative"><div class="container"><div class="navbar-brand ml-0"><a href="https://hstream.io" class="navbar-item"><img loading="lazy" src="/docs/docs-assets/img/logo-hstreamdb.5dbc865d.png" alt="HStreamDB: The streaming database built for IoT data storage and real-time analytics" class="logo"></a><a role="button" aria-label="menu" aria-expanded="false" data-target="navbarBasic" class="navbar-burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu" style="--extra-height:72px"><div class="navbar-start"><a href="/docs/en/latest/" class="navbar-item router-link-active">Docs </a><a href="https://hstream.io/blog" target="_self" rel="noopener" class="navbar-item">Blog </a><a href="https://hstream.io/community" target="_self" rel="noopener" class="navbar-item">Community</a><div class="navbar-item has-dropdown is-hstreamdb"><a class="navbar-link is-arrowless">Company <i class="iconfont icon-arrow-down ml-1 is-size-7"></i></a><div class="navbar-dropdown is-hstreamdb"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-about.png" alt="About Us"></div>About Us </a><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-news.png" alt="Newsroom"></div>Newsroom </a><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-email.png" alt="Contact Us"></div>Contact Us</a></div></div></div><div class="navbar-end"><div class="navbar-item is-hidden-touch"><a href="https://github.com/hstreamdb/hstream" target="_blank" rel="noopener noreferrer nofollow" class="is-flex is-align-items-center has-text-weight-medium is-text-normal hover:is-text-primary is-size-14"><i class="iconfont icon-github mr-2 is-size-4 is-text-black"></i> Star</a></div><div class="navbar-item is-hidden-touch"><a href="https://discord.gg/2fEsuvzYqc" target="_blank" rel="noopener noreferrer nofollow" class="is-flex is-align-items-center has-text-weight-medium is-text-normal hover:is-text-primary is-size-14"><i class="iconfont icon-discord mr-2 is-size-4 is-text-black"></i> Discord</a></div><div class="navbar-item is-hidden-touch"><a href="https://www.emqx.com/en/try?product=hstreamdb" target="_blank" class="button is-gradient is-trans-top has-text-weight-medium">Download</a></div><a href="https://www.emqx.com/en/try?product=hstreamdb" target="_blank" class="navbar-item is-hidden-desktop">Download</a></div></div></div></nav></header><header class="docs-navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><div class="navbar-left"><a href="/docs/en/latest/" class="home-link is-hidden-mobile router-link-active">Documentation </a><a href="/docs/en/latest/" class="home-link is-hidden-tablet router-link-active"><img loading="lazy" src="/docs/docs-assets/img/logo-hstreamdb.5dbc865d.png" alt="HStreamDB: The streaming database built for IoT data storage and real-time analytics" class="logo" style="height:40px;max-width:unset"></a></div><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://hstreamdb/docs/en/latest/" target="_self" class="nav-link external">Docs</a></div><div class="nav-item"><a href="https://hstream.io/blog" target="_self" class="nav-link external">Blog</a></div><div class="nav-item"><a href="https://hstream.io/community" target="_self" class="nav-link external">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Company" class="dropdown-title"><span class="title">Company</span> <span class="arrow down"></span></button> <button type="button" aria-label="Company" class="mobile-dropdown-title"><span class="title">Company</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener noreferrer" class="nav-link external">About Us</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener noreferrer" class="nav-link external">Newsroom</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener noreferrer" class="nav-link external">Contact Us</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/docs/en/latest/" class="nav-link router-link-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/" class="nav-link">中文</a></li></ul></div></div></nav></div></header><div class="sidebar-mask"></div><section class="main-box"><div class="columns is-mobile is-gapless"><aside class="left-column sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://hstreamdb/docs/en/latest/" target="_self" class="nav-link external">Docs</a></div><div class="nav-item"><a href="https://hstream.io/blog" target="_self" class="nav-link external">Blog</a></div><div class="nav-item"><a href="https://hstream.io/community" target="_self" class="nav-link external">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Company" class="dropdown-title"><span class="title">Company</span> <span class="arrow down"></span></button> <button type="button" aria-label="Company" class="mobile-dropdown-title"><span class="title">Company</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener noreferrer" class="nav-link external">About Us</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener noreferrer" class="nav-link external">Newsroom</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener noreferrer" class="nav-link external">Contact Us</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/docs/en/latest/" class="nav-link router-link-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/" class="nav-link">中文</a></li></ul></div></div></nav><div class="mt-6 mb-4"><div id="docsearch" class="algolia-search-box"></div></div><ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Guides</span> <span class="arrow down"></span></p><ul class="sidebar-links sidebar-group-items"><li><a href="/docs/en/latest/guides/write.html" class="sidebar-link">Write Records to Streams</a></li><li><a href="/docs/en/latest/guides/consume.html" aria-current="page" class="active sidebar-link">Consume Records with Subscriptions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#what-is-a-subscription" class="sidebar-link">What is a Subscription?</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#how-to-consume-data-with-a-subscription" class="sidebar-link">How to consume data with a subscription</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#simple-consumer-example" class="sidebar-link">Simple Consumer Example</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#multiple-consumers-and-shared-consumption-progress" class="sidebar-link">Multiple consumers and shared consumption progress</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#flow-control-with-maxunackedrecords" class="sidebar-link">Flow Control with maxUnackedRecords</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#receiving-messages-in-order" class="sidebar-link">Receiving messages in order</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/consume.html#handling-errors" class="sidebar-link">Handling errors</a></li></ul></li><li><a href="/docs/en/latest/guides/stream.html" class="sidebar-link">Create and Manage Streams</a></li><li><a href="/docs/en/latest/guides/subscription.html" class="sidebar-link">Create and Manage Subscriptions</a></li><li><a href="/docs/en/latest/guides/shards.html" class="sidebar-link">Manage Shards of the Stream</a></li><li><a href="/docs/en/latest/guides/reader.html" class="sidebar-link">Get Records from Shards of the Stream with Reader</a></li><li><a href="/docs/en/latest/guides/sql.html" class="sidebar-link">Perform Stream Processing by SQL</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deployment</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Monitoring</span> <span class="arrow right"></span></p></section></li><li><a href="/docs/en/latest/cli/cli.html" class="sidebar-link">HStream CLI</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HStream IO</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p></section></li><li><a href="/docs/en/latest/release_notes/HStreamDB.html" class="sidebar-link">Release notes</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p></section></li></ul><div class="sidebar-bottom"><div class="version-pick"><div class="dropdown-wrapper"><button type="button" class="dropdown-title is-flex is-align-items-center is-justify-content-space-between"><span class="title">latest </span><i class="iconfont icon-arrow-down ml-1 is-size-7"></i></button></div></div><div class="lang-pick"><div class="dropdown-wrapper"><button type="button" class="dropdown-title p-0 is-flex is-align-items-center is-justify-content-end"><i class="iconfont icon-language is-size-4"></i></button><ul class="dropdown-items"><li class="dropdown-item"><a href="/docs/en/latest/" class="router-link-active is-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/">中文</a></li></ul></div></div></div></aside><div class="column"><div class="columns is-mobile is-gapless"><div class="column col-page"><main class="page"><div id="loader-wrapper" style="display:none" data-v-78d8edea><div class="loader" data-v-78d8edea><div class="ball-spin-fade-loader" data-v-78d8edea><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div></div></div></div><div class="theme-default-content reset-width content__default"><h1 id="consume-records-with-subscriptions"><a href="#consume-records-with-subscriptions" class="header-anchor">#</a> Consume Records with Subscriptions</h1><h2 id="what-is-a-subscription"><a href="#what-is-a-subscription" class="header-anchor">#</a> What is a Subscription?</h2><p>To consume data from a stream, you must create a subscription to the stream. When initiated, every subscription will retrieve the data from the beginning. Consumers which receive and process records connect to a stream through a subscription. A stream can have multiple subscriptions, but a given subscription belongs to a single stream. Similarly, a subscription corresponds to one consumer group with multiple consumers. However, every consumer belongs to only a single subscription.</p><p>Please refer to <a href="/docs/en/latest/guides/subscription.html">this page</a> for detailed information about creating and managing your subscriptions.</p><h2 id="how-to-consume-data-with-a-subscription"><a href="#how-to-consume-data-with-a-subscription" class="header-anchor">#</a> How to consume data with a subscription</h2><p>To consume data appended to a stream, HStreamDB Clients libraries have provided asynchronous consumer API, which will initiate requests to join the consumer group of the subscription specified.</p><h3 id="two-hstream-record-types-and-corresponding-receivers"><a href="#two-hstream-record-types-and-corresponding-receivers" class="header-anchor">#</a> Two HStream Record types and corresponding receivers</h3><p>As we <a href="/docs/en/latest/guides/write.html#hstream-record">explained</a>, there are two types of records in HStreamDB, HRecord and RawRecord. When initiating a consumer, corresponding receivers are required. In the case where only HRecord Receiver is set, when the consumer received a raw record, the consumer will ignore it and consume the next record. Therefore, in principle, we do not recommend writing both HRecord and RawRecord in the same stream. However, this is not strictly forbidden in implementation, and you can provide both receivers to process both types of records.</p><h2 id="simple-consumer-example"><a href="#simple-consumer-example" class="header-anchor">#</a> Simple Consumer Example</h2><p>To get higher throughput for your application, we provide asynchronous fetching that does not require your application to block for new messages. Messages can be received in your application using a long-running message receiver and acknowledged one at a time, as shown in the example below.</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ConsumeDataSimpleExample.java</span>

<span class="token keyword">package</span> <span class="token namespace">docs<span class="token punctuation">.</span>code<span class="token punctuation">.</span>examples</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">HRecordReceiver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">HStreamClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumeDataSimpleExample</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> serviceUrl <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:6570&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      serviceUrl <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> subscriptionId <span class="token operator">=</span> <span class="token string">&quot;your_subscription_id&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">HStreamClient</span> client <span class="token operator">=</span> <span class="token class-name">HStreamClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceUrl</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">consumeDataFromSubscriptionExample</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> subscriptionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">consumeDataFromSubscriptionExample</span><span class="token punctuation">(</span>
      <span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> subscriptionId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HRecordReceiver</span> receiver <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">,</span> responder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received a record :&quot;</span> <span class="token operator">+</span> hRecord<span class="token punctuation">.</span><span class="token function">getHRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          responder<span class="token punctuation">.</span><span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Consumer is a Service(ref:</span>
    <span class="token comment">// https://guava.dev/releases/19.0/api/docs/com/google/common/util/concurrent/Service.html)</span>
    <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span>
        client
            <span class="token punctuation">.</span><span class="token function">newConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">subscription</span><span class="token punctuation">(</span>subscriptionId<span class="token punctuation">)</span>
            <span class="token comment">// optional, if it is not set, client will generate a unique id.</span>
            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;consumer_1&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">hRecordReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// start Consumer as a background service and return</span>
    consumer<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">awaitRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// sleep 5s for consuming records</span>
      consumer<span class="token punctuation">.</span><span class="token function">awaitTerminated</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// stop consumer</span>
      consumer<span class="token punctuation">.</span><span class="token function">stopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">awaitTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ExampleConsumeDataSimple.go</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># https://github.com/hstreamdb/hstreamdb-py/blob/main/examples/snippets/guides.py</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> hstreamdb
<span class="token keyword">import</span> os

<span class="token comment"># NOTE: Replace with your own host and port</span>
host <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_PORT&quot;</span><span class="token punctuation">,</span> <span class="token number">6570</span><span class="token punctuation">)</span>
stream_name <span class="token operator">=</span> <span class="token string">&quot;your_stream&quot;</span>
subscription <span class="token operator">=</span> <span class="token string">&quot;your_subscription&quot;</span>


<span class="token comment"># Run: asyncio.run(main(your_async_function))</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token operator">*</span>funcs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> <span class="token keyword">await</span> hstreamdb<span class="token punctuation">.</span>insecure_client<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
            <span class="token keyword">await</span> f<span class="token punctuation">(</span>client<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Processing</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    max_count<span class="token punctuation">:</span> <span class="token builtin">int</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>max_count <span class="token operator">=</span> max_count

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ack_fun<span class="token punctuation">,</span> stop_fun<span class="token punctuation">,</span> rs_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;max_count&quot;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_count<span class="token punctuation">)</span>
        rs <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>rs_iter<span class="token punctuation">)</span>
        <span class="token keyword">for</span> r <span class="token keyword">in</span> rs<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span><span class="token string">] Receive: </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>max_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>max_count<span class="token punctuation">:</span>
                <span class="token keyword">await</span> stop_fun<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

        <span class="token keyword">await</span> ack_fun<span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> rs<span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">subscribe_records</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    consumer <span class="token operator">=</span> client<span class="token punctuation">.</span>new_consumer<span class="token punctuation">(</span><span class="token string">&quot;new_consumer&quot;</span><span class="token punctuation">,</span> subscription<span class="token punctuation">,</span> Processing<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></div></div></div><p>For better performance, Batched Ack is enabled by default with setting <code>ackBufferSize</code> = 100 and <code>ackAgeLimit</code> = 100, which you can change when initiating your consumers.</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Consumer</span> consumer <span class="token operator">=</span>
    client
        <span class="token punctuation">.</span><span class="token function">newConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token string">&quot;you_subscription_id&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;your_consumer_name&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">hRecordReceiver</span><span class="token punctuation">(</span>your_receiver<span class="token punctuation">)</span>
        <span class="token comment">// When ack() is called, the consumer will not send it to servers immediately,</span>
        <span class="token comment">// the ack request will be buffered until the ack count reaches ackBufferSize</span>
        <span class="token comment">// or the consumer is stopping or reached ackAgelimit</span>
        <span class="token punctuation">.</span><span class="token function">ackBufferSize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ackAgeLimit</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div></div></div><h2 id="multiple-consumers-and-shared-consumption-progress"><a href="#multiple-consumers-and-shared-consumption-progress" class="header-anchor">#</a> Multiple consumers and shared consumption progress</h2><p>In HStream, a subscription is consumed by a consumer group. In this consumer group, there could be multiple consumers which share the subscription's progress. To increase the rate of consuming data from a subscription, we could have a new consumer join the existing subscription. The code is for demonstration of how consumers can join the consumer group. Usually, the case is that users would have consumers from different clients.</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ConsumeDataSharedExample.java</span>

<span class="token keyword">package</span> <span class="token namespace">docs<span class="token punctuation">.</span>code<span class="token punctuation">.</span>examples</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">HRecordReceiver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">HStreamClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumeDataSharedExample</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> serviceUrl <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:6570&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      serviceUrl <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> subscription <span class="token operator">=</span> <span class="token string">&quot;your_subscription_id&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> consumer1 <span class="token operator">=</span> <span class="token string">&quot;your_consumer1_name&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> consumer2 <span class="token operator">=</span> <span class="token string">&quot;your_consumer2-name&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">HStreamClient</span> client <span class="token operator">=</span> <span class="token class-name">HStreamClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceUrl</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// create two consumers to consume records including two ordering keys.</span>
    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">consumeDataFromSubscriptionSharedExample</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> subscription<span class="token punctuation">,</span> consumer1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> t2 <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">consumeDataFromSubscriptionSharedExample</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> subscription<span class="token punctuation">,</span> consumer2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">consumeDataFromSubscriptionSharedExample</span><span class="token punctuation">(</span>
      <span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> subscription<span class="token punctuation">,</span> <span class="token class-name">String</span> consumerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HRecordReceiver</span> receiver <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">,</span> responder<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received a record :&quot;</span> <span class="token operator">+</span> hRecord<span class="token punctuation">.</span><span class="token function">getHRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          responder<span class="token punctuation">.</span><span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Consumer</span> consumer <span class="token operator">=</span>
        client
            <span class="token punctuation">.</span><span class="token function">newConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">subscription</span><span class="token punctuation">(</span>subscription<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>consumerName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">hRecordReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// sleep 5s for consuming records</span>
      consumer<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">awaitRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      consumer<span class="token punctuation">.</span><span class="token function">awaitTerminated</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// stop consumer</span>
      consumer<span class="token punctuation">.</span><span class="token function">stopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">awaitTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ExampleConsumeDataShared.go</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div><h2 id="flow-control-with-maxunackedrecords"><a href="#flow-control-with-maxunackedrecords" class="header-anchor">#</a> Flow Control with <code>maxUnackedRecords</code></h2><p>A common scenario is that your consumers may not process and acknowledge data as fast as the server sends, or some unexpected problems causing the consumer client to be unable to acknowledge the data received, which could cause problems as such:</p><p>The server would have to keep resending unacknowledged messages, and maintain the information about unacknowledged messages, which would consume resources of the server, and cause the server to face the issue of resource exhaustion.</p><p>To mitigate the issue above, use the <code>maxUnackedRecords</code> setting of the subscription to control the maximum number of allowed un-acknowledged records when the consumers receive messages. Once the number exceeds the <code>maxUnackedRecords</code>, the server will stop sending messages to consumers of the current subscription.</p><h2 id="receiving-messages-in-order"><a href="#receiving-messages-in-order" class="header-anchor">#</a> Receiving messages in order</h2><p>Note: the order described below is just for a single consumer. If a subscription has multiple consumers, the order can still be guaranteed in each, but the order is no longer preserved if we see the consumer group as an entity.</p><p>Consumers will receive messages with the same partition key in the order that the HStream server receives them. Since HStream delivers hstream records with at-least-once semantics, in some cases, when HServer does not receive the ack for some record in the middle, it might deliver the record more than once. In these cases, we can not guarantee the order either.</p><h2 id="handling-errors"><a href="#handling-errors" class="header-anchor">#</a> Handling errors</h2><p>When a consumer is running, and failure happens at the receiver, the default behaviour is that the consumer will catch the exception, print an error log, and continue consuming the next record instead of failing.</p><p>Consumers could fail in other scenarios, such as network, deleted subscriptions, etc. However, as a service, you may want the consumer to keep running, so you can register a listener to handle a failed consumer:</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// add Listener for handling failed consumer</span>
<span class="token keyword">var</span> threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Service<span class="token punctuation">.</span>Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">Service<span class="token punctuation">.</span>State</span> from<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> failure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumer failed, with error: &quot;</span> <span class="token operator">+</span> failure<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    threadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div></div></div><div class="page-nav reset-width"><p class="inner"><span class="prev">← <a href="/docs/en/latest/guides/write.html" class="prev">Write Records to Streams </a></span><span class="next"><a href="/docs/en/latest/guides/stream.html">Create and Manage Streams </a>→</span></p></div></main></div><div class="right-column"><div class="docs-operation"><div class="doc-download improve-doc"><a href="https://github.com/hstreamdb/docs/edit/latest/docs/en/guides/consume.md" target="_blank" rel="noreferrer" class="improve-doc">Edit this page</a></div><div class="doc-download feedback-doc"><a href="https://github.com/hstreamdb/docs/issues/new?body=File:%20[/docs/en/guides/consume.md](https://hstream.io/docs/en/latest/guides/consume.html)" target="_blank" rel="noreferrer">Request docs changes</a></div></div><section class="doc-toc"><div class="title">What’s on this page</div><div class="toc-content"><ul><li><a href="/docs/en/latest/guides/consume.html#what-is-a-subscription">What is a Subscription?</a></li><li><a href="/docs/en/latest/guides/consume.html#how-to-consume-data-with-a-subscription">How to consume data with a subscription</a></li><li><a href="/docs/en/latest/guides/consume.html#simple-consumer-example">Simple Consumer Example</a></li><li><a href="/docs/en/latest/guides/consume.html#multiple-consumers-and-shared-consumption-progress">Multiple consumers and shared consumption progress</a></li><li><a href="/docs/en/latest/guides/consume.html#flow-control-with-maxunackedrecords">Flow Control with maxUnackedRecords</a></li><li><a href="/docs/en/latest/guides/consume.html#receiving-messages-in-order">Receiving messages in order</a></li><li><a href="/docs/en/latest/guides/consume.html#handling-errors">Handling errors</a></li></ul></div></section></div></div></div></div></section><div id="page-feedback" data-v-fa621f20><div class="feedback-button is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-useful" data-v-fa621f20></use></svg></div><div class="feedback-form" style="display:none" data-v-fa621f20 data-v-fa621f20><div class="feedback-header pl-4 is-flex is-align-items-center is-justify-content-space-between" data-v-fa621f20>Was this page useful?<div class="icon-close p-4" style="cursor:pointer" data-v-fa621f20>x</div></div><div class="feedback-body p-4" data-v-fa621f20><div class="is-flex" data-v-fa621f20 data-v-67fd37ab data-v-fa621f20><div class="feedback-button like mr-5 is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-useful" data-v-fa621f20></use></svg></div><div class="feedback-button dislike is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-a-notuseful" data-v-fa621f20></use></svg></div></div></div></div></div></div><div class="global-ui"></div></div><script src="/docs/docs-assets/js/app.03bf0ac1.js" defer="defer"></script><script src="/docs/docs-assets/js/2.64e3e103.js" defer="defer"></script><script src="/docs/docs-assets/js/28.01df18f1.js" defer="defer"></script></body></html>