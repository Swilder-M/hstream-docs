<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Write Records to Streams | HStreamDB Documentation</title><meta name="generator" content="VuePress 1.9.5"><link rel="shortcut icon" type="image/x-icon" href="/docs/docs-images/favicon-hstreamdb.ico"><link rel="stylesheet" href="https://at.alicdn.com/t/font_3137465_33anb3gl4nt.css"><script charset="utf-8" src="https://at.alicdn.com/t/font_3125249_pld7abubdat.js"></script><link rel="canonical" href="https://hstream.io/docs/en/latest/guides/write.html"><meta name="docsearch:language" content="en"><meta name="docsearch:product" content="hstreamdb"><meta name="docsearch:version" content="latest"><meta name="description" content=""><meta property="og:site_name" content="HStreamDB Documentation"><meta property="og:title" content="Write Records to Streams"><meta property="og:type" content="website"><meta property="og:url" content="https://hstream.io/docs/en/latest/guides/write.html"><meta name="twitter:title" content="Write Records to Streams"><meta name="twitter:url" content="https://hstream.io/docs/en/latest/guides/write.html"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@EMQTech"><meta name="twitter:creator" content="@EMQTech"><meta name="twitter:image" content="https://www.emqx.com/images/logo_512.png"><meta name="twitter:image:alt" content="EMQ LOGO"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta property="og:image" content="https://www.emqx.com/images/logo_512.png"><link rel="preload" href="/docs/docs-assets/css/0.styles.ec078ccc.css" as="style"><link rel="preload" href="/docs/docs-assets/js/app.6d097558.js" as="script"><link rel="preload" href="/docs/docs-assets/js/2.1f9daac7.js" as="script"><link rel="preload" href="/docs/docs-assets/js/35.df64c424.js" as="script"><link rel="prefetch" href="/docs/docs-assets/js/10.c73e278a.js"><link rel="prefetch" href="/docs/docs-assets/js/100.be66b083.js"><link rel="prefetch" href="/docs/docs-assets/js/101.93149e6e.js"><link rel="prefetch" href="/docs/docs-assets/js/102.d44186e1.js"><link rel="prefetch" href="/docs/docs-assets/js/103.f02f5f86.js"><link rel="prefetch" href="/docs/docs-assets/js/104.24bd9604.js"><link rel="prefetch" href="/docs/docs-assets/js/105.0d3cc066.js"><link rel="prefetch" href="/docs/docs-assets/js/106.8d7a14d9.js"><link rel="prefetch" href="/docs/docs-assets/js/107.3435b70c.js"><link rel="prefetch" href="/docs/docs-assets/js/108.76bacd95.js"><link rel="prefetch" href="/docs/docs-assets/js/109.90cba754.js"><link rel="prefetch" href="/docs/docs-assets/js/11.822c0767.js"><link rel="prefetch" href="/docs/docs-assets/js/110.491d2c41.js"><link rel="prefetch" href="/docs/docs-assets/js/111.4137c775.js"><link rel="prefetch" href="/docs/docs-assets/js/112.e9f5a008.js"><link rel="prefetch" href="/docs/docs-assets/js/113.d86a692c.js"><link rel="prefetch" href="/docs/docs-assets/js/114.87878ce9.js"><link rel="prefetch" href="/docs/docs-assets/js/115.9212087e.js"><link rel="prefetch" href="/docs/docs-assets/js/116.86ef4ef3.js"><link rel="prefetch" href="/docs/docs-assets/js/117.e4701683.js"><link rel="prefetch" href="/docs/docs-assets/js/118.e5dd99ad.js"><link rel="prefetch" href="/docs/docs-assets/js/12.267540f5.js"><link rel="prefetch" href="/docs/docs-assets/js/13.6c34971a.js"><link rel="prefetch" href="/docs/docs-assets/js/14.873a2cd6.js"><link rel="prefetch" href="/docs/docs-assets/js/15.19ac1096.js"><link rel="prefetch" href="/docs/docs-assets/js/16.8dc3ef11.js"><link rel="prefetch" href="/docs/docs-assets/js/17.3234f348.js"><link rel="prefetch" href="/docs/docs-assets/js/18.1def2c0f.js"><link rel="prefetch" href="/docs/docs-assets/js/19.c2e1dc81.js"><link rel="prefetch" href="/docs/docs-assets/js/20.9b207b44.js"><link rel="prefetch" href="/docs/docs-assets/js/21.fc4aa3f2.js"><link rel="prefetch" href="/docs/docs-assets/js/22.57975c2a.js"><link rel="prefetch" href="/docs/docs-assets/js/23.287ce156.js"><link rel="prefetch" href="/docs/docs-assets/js/24.5445ec3b.js"><link rel="prefetch" href="/docs/docs-assets/js/25.86ec61cb.js"><link rel="prefetch" href="/docs/docs-assets/js/26.be9e7ff0.js"><link rel="prefetch" href="/docs/docs-assets/js/27.8f5a4b7c.js"><link rel="prefetch" href="/docs/docs-assets/js/28.60514e21.js"><link rel="prefetch" href="/docs/docs-assets/js/29.e64ba7c2.js"><link rel="prefetch" href="/docs/docs-assets/js/3.e5ef1dad.js"><link rel="prefetch" href="/docs/docs-assets/js/30.702075b5.js"><link rel="prefetch" href="/docs/docs-assets/js/31.55f214b0.js"><link rel="prefetch" href="/docs/docs-assets/js/32.8e4b662f.js"><link rel="prefetch" href="/docs/docs-assets/js/33.e67956c0.js"><link rel="prefetch" href="/docs/docs-assets/js/34.3588736d.js"><link rel="prefetch" href="/docs/docs-assets/js/36.e0863f65.js"><link rel="prefetch" href="/docs/docs-assets/js/37.5ea8eecd.js"><link rel="prefetch" href="/docs/docs-assets/js/38.70c33ed6.js"><link rel="prefetch" href="/docs/docs-assets/js/39.9cb9e2d3.js"><link rel="prefetch" href="/docs/docs-assets/js/4.4be52a77.js"><link rel="prefetch" href="/docs/docs-assets/js/40.5d821d26.js"><link rel="prefetch" href="/docs/docs-assets/js/41.98bdf1e8.js"><link rel="prefetch" href="/docs/docs-assets/js/42.811beada.js"><link rel="prefetch" href="/docs/docs-assets/js/43.e4146a81.js"><link rel="prefetch" href="/docs/docs-assets/js/44.bb736090.js"><link rel="prefetch" href="/docs/docs-assets/js/45.0916a620.js"><link rel="prefetch" href="/docs/docs-assets/js/46.88694289.js"><link rel="prefetch" href="/docs/docs-assets/js/47.9dc93bd4.js"><link rel="prefetch" href="/docs/docs-assets/js/48.7ab3fceb.js"><link rel="prefetch" href="/docs/docs-assets/js/49.319215e3.js"><link rel="prefetch" href="/docs/docs-assets/js/5.ddfe8543.js"><link rel="prefetch" href="/docs/docs-assets/js/50.47693d9c.js"><link rel="prefetch" href="/docs/docs-assets/js/51.9bc7ec30.js"><link rel="prefetch" href="/docs/docs-assets/js/52.937e4b1f.js"><link rel="prefetch" href="/docs/docs-assets/js/53.be89e0bf.js"><link rel="prefetch" href="/docs/docs-assets/js/54.280dbe78.js"><link rel="prefetch" href="/docs/docs-assets/js/55.ffdde7ba.js"><link rel="prefetch" href="/docs/docs-assets/js/56.ca672ef2.js"><link rel="prefetch" href="/docs/docs-assets/js/57.2952de86.js"><link rel="prefetch" href="/docs/docs-assets/js/58.1e1e3998.js"><link rel="prefetch" href="/docs/docs-assets/js/59.b2f7ec9f.js"><link rel="prefetch" href="/docs/docs-assets/js/6.9933831d.js"><link rel="prefetch" href="/docs/docs-assets/js/60.da6305f9.js"><link rel="prefetch" href="/docs/docs-assets/js/61.6bc588ef.js"><link rel="prefetch" href="/docs/docs-assets/js/62.e23f724d.js"><link rel="prefetch" href="/docs/docs-assets/js/63.9803d678.js"><link rel="prefetch" href="/docs/docs-assets/js/64.6459ae20.js"><link rel="prefetch" href="/docs/docs-assets/js/65.2b3d666f.js"><link rel="prefetch" href="/docs/docs-assets/js/66.b87c5926.js"><link rel="prefetch" href="/docs/docs-assets/js/67.e06114ee.js"><link rel="prefetch" href="/docs/docs-assets/js/68.af56e3c9.js"><link rel="prefetch" href="/docs/docs-assets/js/69.4eccf8f5.js"><link rel="prefetch" href="/docs/docs-assets/js/7.3e32632c.js"><link rel="prefetch" href="/docs/docs-assets/js/70.43735f8d.js"><link rel="prefetch" href="/docs/docs-assets/js/71.40d746a0.js"><link rel="prefetch" href="/docs/docs-assets/js/72.c2ae8a9f.js"><link rel="prefetch" href="/docs/docs-assets/js/73.da5d1c41.js"><link rel="prefetch" href="/docs/docs-assets/js/74.5b016c05.js"><link rel="prefetch" href="/docs/docs-assets/js/75.35121ba5.js"><link rel="prefetch" href="/docs/docs-assets/js/76.e5cf07e4.js"><link rel="prefetch" href="/docs/docs-assets/js/77.d4c0280c.js"><link rel="prefetch" href="/docs/docs-assets/js/78.662d9403.js"><link rel="prefetch" href="/docs/docs-assets/js/79.d0a33137.js"><link rel="prefetch" href="/docs/docs-assets/js/8.ac307652.js"><link rel="prefetch" href="/docs/docs-assets/js/80.2772e1da.js"><link rel="prefetch" href="/docs/docs-assets/js/81.4f56ae69.js"><link rel="prefetch" href="/docs/docs-assets/js/82.1d3b19b5.js"><link rel="prefetch" href="/docs/docs-assets/js/83.289417d8.js"><link rel="prefetch" href="/docs/docs-assets/js/84.b8447436.js"><link rel="prefetch" href="/docs/docs-assets/js/85.bb937bf2.js"><link rel="prefetch" href="/docs/docs-assets/js/86.56d1720f.js"><link rel="prefetch" href="/docs/docs-assets/js/87.e3c6754b.js"><link rel="prefetch" href="/docs/docs-assets/js/88.9de63e11.js"><link rel="prefetch" href="/docs/docs-assets/js/89.429c2645.js"><link rel="prefetch" href="/docs/docs-assets/js/9.34fbcbca.js"><link rel="prefetch" href="/docs/docs-assets/js/90.435f81a4.js"><link rel="prefetch" href="/docs/docs-assets/js/91.3e81a2bc.js"><link rel="prefetch" href="/docs/docs-assets/js/92.86269268.js"><link rel="prefetch" href="/docs/docs-assets/js/93.c9897416.js"><link rel="prefetch" href="/docs/docs-assets/js/94.20065139.js"><link rel="prefetch" href="/docs/docs-assets/js/95.13f29a76.js"><link rel="prefetch" href="/docs/docs-assets/js/96.85425064.js"><link rel="prefetch" href="/docs/docs-assets/js/97.860c8a44.js"><link rel="prefetch" href="/docs/docs-assets/js/98.59d9a53e.js"><link rel="prefetch" href="/docs/docs-assets/js/99.1b14b7cf.js"><link rel="stylesheet" href="/docs/docs-assets/css/0.styles.ec078ccc.css"></head><body><div id="app" data-server-rendered="true"><div class="theme-container"><header id="app-header" class="is-clearfix is-hidden-mobile"><nav id="navbar" role="navigation" aria-label="main navigation" class="navbar is-relative"><div class="container"><div class="navbar-brand ml-0"><a href="https://hstream.io" class="navbar-item"><img loading="lazy" src="/docs/docs-assets/img/logo-hstreamdb.5dbc865d.png" alt="HStreamDB: The streaming database built for IoT data storage and real-time analytics" class="logo"></a><a role="button" aria-label="menu" aria-expanded="false" data-target="navbarBasic" class="navbar-burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu" style="--extra-height:72px"><div class="navbar-start"><a href="/docs/en/latest/" class="navbar-item router-link-active">Docs </a><a href="https://hstream.io/blog" target="_self" rel="noopener" class="navbar-item">Blog </a><a href="https://hstream.io/community" target="_self" rel="noopener" class="navbar-item">Community</a><div class="navbar-item has-dropdown is-hstreamdb"><a class="navbar-link is-arrowless">Company <i class="iconfont icon-arrow-down ml-1 is-size-7"></i></a><div class="navbar-dropdown is-hstreamdb"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-about.png" alt="About Us"></div>About Us </a><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-news.png" alt="Newsroom"></div>Newsroom </a><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener" class="dropdown-item is-flex is-align-items-center is-text-normal hover:is-text-primary has-text-weight-medium"><div class="dropdown-item-icon mr-3 p-2"><img loading="lazy" src="/docs/docs-images/hstreamdb/header/icon-email.png" alt="Contact Us"></div>Contact Us</a></div></div></div><div class="navbar-end"><div class="navbar-item is-hidden-touch"><a href="https://github.com/hstreamdb/hstream" target="_blank" rel="noopener noreferrer nofollow" class="is-flex is-align-items-center has-text-weight-medium is-text-normal hover:is-text-primary is-size-14"><i class="iconfont icon-github mr-2 is-size-4 is-text-black"></i> Star</a></div><div class="navbar-item is-hidden-touch"><a href="https://discord.gg/2fEsuvzYqc" target="_blank" rel="noopener noreferrer nofollow" class="is-flex is-align-items-center has-text-weight-medium is-text-normal hover:is-text-primary is-size-14"><i class="iconfont icon-discord mr-2 is-size-4 is-text-black"></i> Discord</a></div><div class="navbar-item is-hidden-touch"><a href="https://www.emqx.com/en/try?product=hstreamdb" target="_blank" class="button is-gradient is-trans-top has-text-weight-medium">Download</a></div><a href="https://www.emqx.com/en/try?product=hstreamdb" target="_blank" class="navbar-item is-hidden-desktop">Download</a></div></div></div></nav></header><header class="docs-navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><div class="navbar-left"><a href="/docs/en/latest/" class="home-link is-hidden-mobile router-link-active">Documentation </a><a href="/docs/en/latest/" class="home-link is-hidden-tablet router-link-active"><img loading="lazy" src="/docs/docs-assets/img/logo-hstreamdb.5dbc865d.png" alt="HStreamDB: The streaming database built for IoT data storage and real-time analytics" class="logo" style="height:40px;max-width:unset"></a></div><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://hstreamdb/docs/en/latest/" target="_self" class="nav-link external">Docs</a></div><div class="nav-item"><a href="https://hstream.io/blog" target="_self" class="nav-link external">Blog</a></div><div class="nav-item"><a href="https://hstream.io/community" target="_self" class="nav-link external">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Company" class="dropdown-title"><span class="title">Company</span> <span class="arrow down"></span></button> <button type="button" aria-label="Company" class="mobile-dropdown-title"><span class="title">Company</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener noreferrer" class="nav-link external">About Us</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener noreferrer" class="nav-link external">Newsroom</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener noreferrer" class="nav-link external">Contact Us</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/docs/en/latest/" class="nav-link router-link-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/" class="nav-link">中文</a></li></ul></div></div></nav></div></header><div class="sidebar-mask"></div><section class="main-box"><div class="columns is-mobile is-gapless"><aside class="left-column sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://hstreamdb/docs/en/latest/" target="_self" class="nav-link external">Docs</a></div><div class="nav-item"><a href="https://hstream.io/blog" target="_self" class="nav-link external">Blog</a></div><div class="nav-item"><a href="https://hstream.io/community" target="_self" class="nav-link external">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Company" class="dropdown-title"><span class="title">Company</span> <span class="arrow down"></span></button> <button type="button" aria-label="Company" class="mobile-dropdown-title"><span class="title">Company</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="https://www.emqx.com/en/about" target="_blank" rel="noopener noreferrer" class="nav-link external">About Us</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/news" target="_blank" rel="noopener noreferrer" class="nav-link external">Newsroom</a></li><li class="dropdown-item"><a href="https://www.emqx.com/en/contact?product=hstreamdb" target="_blank" rel="noopener noreferrer" class="nav-link external">Contact Us</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button><ul class="nav-dropdown" style="display:none"><li class="dropdown-item"><a href="/docs/en/latest/" class="nav-link router-link-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/" class="nav-link">中文</a></li></ul></div></div></nav><div class="mt-6 mb-4"><div id="docsearch" class="algolia-search-box"></div></div><ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p></section></li><li><a href="/docs/en/latest/start/quickstart-with-docker.html" class="sidebar-link">Getting started</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Guides</span> <span class="arrow down"></span></p><ul class="sidebar-links sidebar-group-items"><li><a href="/docs/en/latest/guides/write.html" aria-current="page" class="active sidebar-link">Write Records to Streams</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/write.html#hstream-record" class="sidebar-link">HStream Record</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/write.html#write-hstream-records" class="sidebar-link">Write HStream Records</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/write.html#write-records-using-producer" class="sidebar-link">Write Records Using Producer</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/write.html#write-records-using-buffered-producer" class="sidebar-link">Write Records Using Buffered Producer</a></li><li class="sidebar-sub-header"><a href="/docs/en/latest/guides/write.html#write-records-with-partition-keys" class="sidebar-link">Write Records with Partition Keys</a></li></ul></li><li><a href="/docs/en/latest/guides/consume.html" class="sidebar-link">Consume Records with Subscriptions</a></li><li><a href="/docs/en/latest/guides/stream.html" class="sidebar-link">Create and Manage Streams</a></li><li><a href="/docs/en/latest/guides/subscription.html" class="sidebar-link">Create and Manage Subscriptions</a></li><li><a href="/docs/en/latest/guides/shards.html" class="sidebar-link">Manage Shards of the Stream</a></li><li><a href="/docs/en/latest/guides/reader.html" class="sidebar-link">Get Records from Shards of the Stream with Reader</a></li><li><a href="/docs/en/latest/guides/sql.html" class="sidebar-link">Perform Stream Processing by SQL</a></li></ul></section></li><li><a href="/docs/en/latest/cli/cli.html" class="sidebar-link">HStream CLI</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HStream IO</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HStream SQL</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deployment</span> <span class="arrow right"></span></p></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p></section></li><li><a href="/docs/en/latest/monitoring/grafana.html" class="sidebar-link">Monitoring</a></li><li><a href="/docs/en/latest/release_notes/HStreamDB.html" class="sidebar-link">Release notes</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p></section></li></ul><div class="sidebar-bottom"><div class="version-pick"><div class="dropdown-wrapper"><button type="button" class="dropdown-title is-flex is-align-items-center is-justify-content-space-between"><span class="title">latest </span><i class="iconfont icon-arrow-down ml-1 is-size-7"></i></button></div></div><div class="lang-pick"><div class="dropdown-wrapper"><button type="button" class="dropdown-title p-0 is-flex is-align-items-center is-justify-content-end"><i class="iconfont icon-language is-size-4"></i></button><ul class="dropdown-items"><li class="dropdown-item"><a href="/docs/en/latest/" class="router-link-active is-active">English</a></li><li class="dropdown-item"><a href="/docs/zh/latest/">中文</a></li></ul></div></div></div></aside><div class="column"><div class="columns is-mobile is-gapless"><div class="column col-page"><main class="page"><div id="loader-wrapper" style="display:none" data-v-78d8edea><div class="loader" data-v-78d8edea><div class="ball-spin-fade-loader" data-v-78d8edea><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div><div data-v-78d8edea></div></div></div></div><div class="theme-default-content reset-width content__default"><h1 id="write-records-to-streams"><a href="#write-records-to-streams" class="header-anchor">#</a> Write Records to Streams</h1><p>This document provides information about how to write data to streams in HStreamDB using hstreamdb-java.</p><p>You can also read following pages to get a more thorough understanding:</p><ul><li>How to <a href="/docs/en/latest/guides/stream.html">create and manage Streams</a>.</li><li>How to <a href="/docs/en/latest/guides/read.html">consume the data written to a Stream</a>.</li></ul><p>To write data to HStreamDB, we need to pack messages as HStream Records and a producer that creates and sends messages to servers.</p><h2 id="hstream-record"><a href="#hstream-record" class="header-anchor">#</a> HStream Record</h2><p>All data in streams are in the form of an HStream Record. There are two kinds of HStream Record:</p><ul><li><p><strong>HRecord</strong>: You can think of an hrecord as a piece of JSON data, just like the document in some NoSQL databases.</p></li><li><p><strong>Raw Record</strong>: Arbitrary binary data.</p></li></ul><h2 id="write-hstream-records"><a href="#write-hstream-records" class="header-anchor">#</a> Write HStream Records</h2><p>There are two ways to write records to servers. For simplicity, you can use <code>Producer</code> from <code>client.newProducer()</code> to start with. <code>Producer</code>s do not provide any configure options, it simply sends records to servers as soon as possible, and all these records are sent in parallel, which means they are unordered. In practice, <code>BufferedProducer</code> from the <code>client.newBufferedProducer()</code> would always be better. <code>BufferedProducer</code> will buffer records in order as a batch and send the batch to servers. When a record is written to the stream, HStream Server will generate a corresponding record id for the record and send it back to the client. The record id is unique in the stream.</p><h2 id="write-records-using-producer"><a href="#write-records-using-producer" class="header-anchor">#</a> Write Records Using Producer</h2><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// WriteDataSimpleExample.java</span>

<span class="token keyword">package</span> <span class="token namespace">docs<span class="token punctuation">.</span>code<span class="token punctuation">.</span>examples</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">Record</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteDataSimpleExample</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO (developers): Replace these variables for your own use cases.</span>
    <span class="token class-name">String</span> serviceUrl <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:6570&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      serviceUrl <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> streamName1 <span class="token operator">=</span> <span class="token string">&quot;your_h_records_stream_name&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> streamName2 <span class="token operator">=</span> <span class="token string">&quot;your_raw_records_stream_name&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// We do not recommend write both raw data and HRecord data into the same stream.</span>
    <span class="token class-name">HStreamClient</span> client <span class="token operator">=</span> <span class="token class-name">HStreamClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceUrl</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">writeHRecordData</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> streamName1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">writeRawData</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> streamName2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeHRecordData</span><span class="token punctuation">(</span><span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> streamName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a basic producer for low latency scenarios</span>
    <span class="token comment">// For high throughput scenarios, please see the next section &quot;Using `BufferedProducer`s&quot;</span>
    <span class="token class-name">Producer</span> producer <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>streamName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">HRecord</span> hRecord <span class="token operator">=</span>
        <span class="token class-name">HRecord</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// Number</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token comment">// Boolean</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;isReady&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token comment">// List</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;targets&quot;</span><span class="token punctuation">,</span> <span class="token class-name">HArray</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// String</span>
            <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hRecord-example&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Record</span> <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hRecord</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// If the data is written successfully, returns a server-assigned record id</span>
      <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> recordId <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wrote message ID: &quot;</span> <span class="token operator">+</span> recordId<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeRawData</span><span class="token punctuation">(</span><span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> streamName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Producer</span> producer <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>streamName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Record</span> <span class="token keyword">record</span> <span class="token operator">=</span>
          <span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rawRecord</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> recordId <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Published message ID: &quot;</span> <span class="token operator">+</span> recordId<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ExampleWriteProducer.go</span>

<span class="token keyword">package</span> examples

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream&quot;</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream/Record&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">ExampleWriteProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	client<span class="token punctuation">,</span> err <span class="token operator">:=</span> hstream<span class="token punctuation">.</span><span class="token function">NewHStreamClient</span><span class="token punctuation">(</span>YourHStreamServiceUrl<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating client error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	producer<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewProducer</span><span class="token punctuation">(</span><span class="token string">&quot;testStream&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating producer error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> producer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	payload <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello HStreamDB&quot;</span><span class="token punctuation">)</span>

	rawRecord<span class="token punctuation">,</span> err <span class="token operator">:=</span> Record<span class="token punctuation">.</span><span class="token function">NewHStreamRawRecord</span><span class="token punctuation">(</span><span class="token string">&quot;testStream&quot;</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating raw record error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		appendRes <span class="token operator">:=</span> producer<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>rawRecord<span class="token punctuation">)</span>
		<span class="token keyword">if</span> resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> appendRes<span class="token punctuation">.</span><span class="token function">Ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Append error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Append response: %s&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># https://github.com/hstreamdb/hstreamdb-py/blob/main/examples/snippets/guides.py</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> hstreamdb
<span class="token keyword">import</span> os

<span class="token comment"># NOTE: Replace with your own host and port</span>
host <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_PORT&quot;</span><span class="token punctuation">,</span> <span class="token number">6570</span><span class="token punctuation">)</span>
stream_name <span class="token operator">=</span> <span class="token string">&quot;your_stream&quot;</span>
subscription <span class="token operator">=</span> <span class="token string">&quot;your_subscription&quot;</span>


<span class="token comment"># Run: asyncio.run(main(your_async_function))</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token operator">*</span>funcs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> <span class="token keyword">await</span> hstreamdb<span class="token punctuation">.</span>insecure_client<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
            <span class="token keyword">await</span> f<span class="token punctuation">(</span>client<span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">append_records</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payloads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;some_raw_binary_bytes&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    rs <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stream_name<span class="token punctuation">,</span> payloads<span class="token punctuation">)</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> rs<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Append done, &quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div></div></div><h2 id="write-records-using-buffered-producer"><a href="#write-records-using-buffered-producer" class="header-anchor">#</a> Write Records Using Buffered Producer</h2><p>In almost all scenarios, we would recommend using <code>BufferedProducer</code> whenever possible because it offers higher throughput and provides a very flexible configuration that allows you to adjust between throughput and latency as needed. You can configure the following two settings of BufferedProducer to control and set the trigger and the buffer size. With <code>BatchSetting</code>, you can determine when to send the batch based on the maximum number of records, byte size in the batch and the maximum age of the batch. By configuring <code>FlowControlSetting</code>, you can set the buffer for all records. The following code example shows how you can use <code>BatchSetting</code> to set responding triggers to notify when the producer should flush and <code>FlowControlSetting</code> to limit maximum bytes in a BufferedProducer.</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// WriteDataBufferedExample.java</span>

<span class="token keyword">package</span> <span class="token namespace">docs<span class="token punctuation">.</span>code<span class="token punctuation">.</span>examples</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">Record</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteDataBufferedExample</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO (developers): Replace these variables for your own use cases.</span>
    <span class="token class-name">String</span> serviceUrl <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:6570&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      serviceUrl <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> streamName <span class="token operator">=</span> <span class="token string">&quot;your_h_records_stream_name&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">HStreamClient</span> client <span class="token operator">=</span> <span class="token class-name">HStreamClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceUrl</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">writeHRecordDataWithBufferedProducers</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> streamName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeHRecordDataWithBufferedProducers</span><span class="token punctuation">(</span>
      <span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> streamName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BatchSetting</span> batchSetting <span class="token operator">=</span>
        <span class="token class-name">BatchSetting</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// optional, default: 100, the max records count of a batch,</span>
            <span class="token comment">// disable the trigger if the value &lt;= 0.</span>
            <span class="token punctuation">.</span><span class="token function">recordCountLimit</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>

            <span class="token comment">// optional, default: 4096(4KB), the max bytes size of a batch,</span>
            <span class="token comment">// disable the trigger if the value &lt;= 0.</span>
            <span class="token punctuation">.</span><span class="token function">bytesLimit</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>

            <span class="token comment">// optional, default: 100(ms), the max age of a buffering batch,</span>
            <span class="token comment">// disable the trigger if the value &lt;= 0.</span>
            <span class="token punctuation">.</span><span class="token function">ageLimit</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// FlowControlSetting is to control total records,</span>
    <span class="token comment">// including buffered batch records and sending records</span>
    <span class="token class-name">FlowControlSetting</span> flowControlSetting <span class="token operator">=</span>
        <span class="token class-name">FlowControlSetting</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// Optional, the default: 104857600(100MB), total bytes limit, including buffered batch</span>
            <span class="token comment">// records and</span>
            <span class="token comment">// sending records, the value must be greater than batchSetting.bytesLimit</span>
            <span class="token punctuation">.</span><span class="token function">bytesLimit</span><span class="token punctuation">(</span><span class="token number">40960</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BufferedProducer</span> producer <span class="token operator">=</span>
        client<span class="token punctuation">.</span><span class="token function">newBufferedProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>streamName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">batchSetting</span><span class="token punctuation">(</span>batchSetting<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">flowControlSetting</span><span class="token punctuation">(</span>flowControlSetting<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> recordIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">double</span> temp <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10.0</span> <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">;</span>
      <span class="token class-name">HRecord</span> hRecord <span class="token operator">=</span> <span class="token class-name">HRecord</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Record</span> <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hRecord</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> recordId <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      recordIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>recordId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// close a producer, it will call flush() first</span>
    producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wrote message IDs: &quot;</span> <span class="token operator">+</span> recordIds<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">join</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ExampleWriteBatchProducer.go</span>

<span class="token keyword">package</span> examples

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream&quot;</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream/Record&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">ExampleWriteBatchProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	client<span class="token punctuation">,</span> err <span class="token operator">:=</span> hstream<span class="token punctuation">.</span><span class="token function">NewHStreamClient</span><span class="token punctuation">(</span>YourHStreamServiceUrl<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating client error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	producer<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewBatchProducer</span><span class="token punctuation">(</span><span class="token string">&quot;testDefaultStream&quot;</span><span class="token punctuation">,</span> hstream<span class="token punctuation">.</span><span class="token function">WithBatch</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating producer error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> producer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>hstream<span class="token punctuation">.</span>AppendResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		rawRecord<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> Record<span class="token punctuation">.</span><span class="token function">NewHStreamHRecord</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
			<span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span>      i<span class="token punctuation">,</span>
			<span class="token string">&quot;isReady&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span>    <span class="token string">&quot;hRecord-example&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		r <span class="token operator">:=</span> producer<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>rawRecord<span class="token punctuation">)</span>
		result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i<span class="token punctuation">,</span> res <span class="token operator">:=</span> <span class="token keyword">range</span> result <span class="token punctuation">{</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> res<span class="token punctuation">.</span><span class="token function">Ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;write error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;record[%d]=%s\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># https://github.com/hstreamdb/hstreamdb-py/blob/main/examples/snippets/guides.py</span>
<span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> hstreamdb
<span class="token keyword">import</span> os

<span class="token comment"># NOTE: Replace with your own host and port</span>
host <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;GUIDE_PORT&quot;</span><span class="token punctuation">,</span> <span class="token number">6570</span><span class="token punctuation">)</span>
stream_name <span class="token operator">=</span> <span class="token string">&quot;your_stream&quot;</span>
subscription <span class="token operator">=</span> <span class="token string">&quot;your_subscription&quot;</span>


<span class="token comment"># Run: asyncio.run(main(your_async_function))</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token operator">*</span>funcs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> <span class="token keyword">await</span> hstreamdb<span class="token punctuation">.</span>insecure_client<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
            <span class="token keyword">await</span> f<span class="token punctuation">(</span>client<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">AppendCallback</span><span class="token punctuation">(</span>hstreamdb<span class="token punctuation">.</span>BufferedProducer<span class="token punctuation">.</span>AppendCallback<span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">on_success</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream_name<span class="token punctuation">,</span> payloads<span class="token punctuation">,</span> stream_keyid<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Batch </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span><span class="token string">: Append success with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>payloads<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> payloads.&quot;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">on_fail</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream_name<span class="token punctuation">,</span> payloads<span class="token punctuation">,</span> stream_keyid<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Append failed!&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">buffered_append_records</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> client<span class="token punctuation">.</span>new_producer<span class="token punctuation">(</span>
        append_callback<span class="token operator">=</span>AppendCallback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        size_trigger<span class="token operator">=</span><span class="token number">10240</span><span class="token punctuation">,</span>
        time_trigger<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
        retry_count<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> p<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stream_name<span class="token punctuation">,</span> <span class="token string">b&quot;some_raw_binary_bytes&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> p<span class="token punctuation">.</span>append<span class="token punctuation">(</span>stream_name<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> p<span class="token punctuation">.</span>wait_and_close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></div></div></div><h2 id="write-records-with-partition-keys"><a href="#write-records-with-partition-keys" class="header-anchor">#</a> Write Records with Partition Keys</h2><p>Partition keys are optional, and if not given, the server will automatically assign a default key. Records with the same partition key can be guaranteed to be written orderly in BufferedProducer.</p><p>Another important feature of HStreamDB, sharding, uses these partition keys to decide which shards the record will be allocated and improve write/read performance. See <a href="/docs/en/latest/guides/shards.html">Manage Shards of a Stream</a> for a more detailed explanation.</p><p>You can easily write records with keys using the following example:</p><div class="el-tabs el-tabs--top el-tabs--border-card"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(0)"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// WriteDataWithKeyExample.java</span>

<span class="token keyword">package</span> <span class="token namespace">docs<span class="token punctuation">.</span>code<span class="token punctuation">.</span>examples</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>hstream<span class="token punctuation">.</span></span><span class="token class-name">Record</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteDataWithKeyExample</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO (developers): Replace these variables for your own use cases.</span>
    <span class="token class-name">String</span> serviceUrl <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:6570&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      serviceUrl <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;serviceUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> streamName <span class="token operator">=</span> <span class="token string">&quot;your_h_records_stream_name&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">HStreamClient</span> client <span class="token operator">=</span> <span class="token class-name">HStreamClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceUrl</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">writeHRecordDataWithKey</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> streamName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeHRecordDataWithKey</span><span class="token punctuation">(</span><span class="token class-name">HStreamClient</span> client<span class="token punctuation">,</span> <span class="token class-name">String</span> streamName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// For demonstrations, we would use the following as our ordering keys for the records.</span>
    <span class="token comment">// As the documentations mentioned, if we do not give any ordering key, it will get a default</span>
    <span class="token comment">// key and be mapped to some default shard.</span>
    <span class="token class-name">String</span> key1 <span class="token operator">=</span> <span class="token string">&quot;South&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> key2 <span class="token operator">=</span> <span class="token string">&quot;North&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a buffered producer with default BatchSetting and FlowControlSetting.</span>
    <span class="token class-name">BufferedProducer</span> producer <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newBufferedProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>streamName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> recordIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">double</span> temp <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10.0</span> <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">;</span>
      <span class="token class-name">Record</span> <span class="token keyword">record</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HRecord</span> hRecord <span class="token operator">=</span> <span class="token class-name">HRecord</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;withKey&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hRecord</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partitionKey</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">HRecord</span> hRecord <span class="token operator">=</span> <span class="token class-name">HRecord</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;withKey&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">record</span> <span class="token operator">=</span> <span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hRecord</span><span class="token punctuation">(</span>hRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partitionKey</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> recordId <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      recordIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>recordId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Wrote message IDs: &quot;</span> <span class="token operator">+</span> recordIds<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">join</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></div><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none"><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ExampleWriteBatchProducerMultiKey.go</span>

<span class="token keyword">package</span> examples

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream&quot;</span>
	<span class="token string">&quot;github.com/hstreamdb/hstreamdb-go/hstream/Record&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">ExampleWriteBatchProducerMultiKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	client<span class="token punctuation">,</span> err <span class="token operator">:=</span> hstream<span class="token punctuation">.</span><span class="token function">NewHStreamClient</span><span class="token punctuation">(</span>YourHStreamServiceUrl<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating client error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	producer<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewBatchProducer</span><span class="token punctuation">(</span><span class="token string">&quot;testStream&quot;</span><span class="token punctuation">,</span> hstream<span class="token punctuation">.</span><span class="token function">WithBatch</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Creating producer error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> producer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	keys <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;sensor1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sensor2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sensor3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sensor4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sensor5&quot;</span><span class="token punctuation">}</span>
	rids <span class="token operator">:=</span> sync<span class="token punctuation">.</span>Map<span class="token punctuation">{</span><span class="token punctuation">}</span>
	wg <span class="token operator">:=</span> sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">{</span><span class="token punctuation">}</span>
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> keys <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>hstream<span class="token punctuation">.</span>AppendResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
				temp <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10.0</span> <span class="token operator">+</span> <span class="token number">15</span>
				rawRecord<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> Record<span class="token punctuation">.</span><span class="token function">NewHStreamHRecord</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
					key<span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;temperature=%d&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				r <span class="token operator">:=</span> producer<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>rawRecord<span class="token punctuation">)</span>
				result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			rids<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	rids<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
		k <span class="token operator">:=</span> key<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
		res <span class="token operator">:=</span> value<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>hstream<span class="token punctuation">.</span>AppendResult<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
			resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;write error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;[key: %s]: record[%d]=%s\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> i<span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div></div></div></div></div><div class="page-nav reset-width"><p class="inner"><span class="prev">← <a href="/docs/en/latest/start/quickstart-with-docker.html" class="prev">Getting started </a></span><span class="next"><a href="/docs/en/latest/guides/consume.html">Consume Records with Subscriptions </a>→</span></p></div></main></div><div class="right-column"><div class="docs-operation"><div class="doc-download improve-doc"><a href="https://github.com/hstreamdb/docs/edit/latest/docs/en/guides/write.md" target="_blank" rel="noreferrer" class="improve-doc">Edit this page</a></div><div class="doc-download feedback-doc"><a href="https://github.com/hstreamdb/docs/issues/new?body=File:%20[/docs/en/guides/write.md](https://hstream.io/docs/en/latest/guides/write.html)" target="_blank" rel="noreferrer">Request docs changes</a></div></div><section class="doc-toc"><div class="title">What’s on this page</div><div class="toc-content"><ul><li><a href="/docs/en/latest/guides/write.html#hstream-record">HStream Record</a></li><li><a href="/docs/en/latest/guides/write.html#write-hstream-records">Write HStream Records</a></li><li><a href="/docs/en/latest/guides/write.html#write-records-using-producer">Write Records Using Producer</a></li><li><a href="/docs/en/latest/guides/write.html#write-records-using-buffered-producer">Write Records Using Buffered Producer</a></li><li><a href="/docs/en/latest/guides/write.html#write-records-with-partition-keys">Write Records with Partition Keys</a></li></ul></div></section></div></div></div></div></section><div id="page-feedback" data-v-fa621f20><div class="feedback-button is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-useful" data-v-fa621f20></use></svg></div><div class="feedback-form" style="display:none" data-v-fa621f20 data-v-fa621f20><div class="feedback-header pl-4 is-flex is-align-items-center is-justify-content-space-between" data-v-fa621f20>Was this page useful?<div class="icon-close p-4" style="cursor:pointer" data-v-fa621f20>x</div></div><div class="feedback-body p-4" data-v-fa621f20><div class="is-flex" data-v-fa621f20 data-v-67fd37ab data-v-fa621f20><div class="feedback-button like mr-5 is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-useful" data-v-fa621f20></use></svg></div><div class="feedback-button dislike is-flex is-align-items-center is-justify-content-center" data-v-fa621f20><svg aria-hidden="true" class="icon" data-v-fa621f20><use xlink:href="#icon-a-notuseful" data-v-fa621f20></use></svg></div></div></div></div></div></div><div class="global-ui"></div></div><script src="/docs/docs-assets/js/app.6d097558.js" defer="defer"></script><script src="/docs/docs-assets/js/2.1f9daac7.js" defer="defer"></script><script src="/docs/docs-assets/js/35.df64c424.js" defer="defer"></script></body></html>