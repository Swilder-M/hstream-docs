(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{459:function(a,s,e){a.exports=e.p+"docs-assets/img/add-panel.1c768e5a.png"},460:function(a,s,e){a.exports=e.p+"docs-assets/img/add-a-panel.8363318e.png"},461:function(a,s,e){a.exports=e.p+"docs-assets/img/create-dashboard.f765342e.png"},462:function(a,s,e){a.exports=e.p+"docs-assets/img/save.5b7a97c1.png"},500:function(a,s,e){"use strict";e.r(s);var t=e(11),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"monitoring-hstreamdb-using-grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-hstreamdb-using-grafana"}},[a._v("#")]),a._v(" Monitoring HStreamDB Using Grafana")]),a._v(" "),t("p",[a._v("Having a comprehensive visualisation of the metrics of the deployed HStreamDB cluster makes it\neasier for analysing the status and diagnosing problems. This document aimed at describing how to\ndeploy the Grafana and its corresponding tools along with HStreamDB instances.")]),a._v(" "),t("h2",{attrs:{id:"architecture-overview-and-development-instructions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#architecture-overview-and-development-instructions"}},[a._v("#")]),a._v(" Architecture Overview and Development Instructions")]),a._v(" "),t("p",[a._v("A binary of HStream HTTP Server can be downloaded from\nthe "),t("a",{attrs:{href:"https://github.com/hstreamdb/http-services/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("release page"),t("OutboundLink")],1),a._v(". Start the HTTP Server\nby "),t("code",[a._v("<path-to-decompressed-release>/bin/http-server -services-url <hstreamdb-server address>")]),a._v(" as a\ndependency of HStream Metrics Exporter. The HTTP Server will collect metrics and execute admin\nrequests.")]),a._v(" "),t("p",[a._v("The HStream Metrics Exporter can be started similarly, which exports the metrics to Prometheus as a\nPrometheus target. Usages and releases can be found on\nits "),t("a",{attrs:{href:"https://github.com/hstreamdb/hstream-metrics-exporter",target:"_blank",rel:"noopener noreferrer"}},[a._v("homepage"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[a._v("The Node Exporter is also a Prometheus target, which serves as an exporter for monitoring the\nmachine metrics. It should be deployed one per HStream node. Information about the installation and\nusage can be found on its "),t("a",{attrs:{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noopener noreferrer"}},[a._v("homepage"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[a._v("The above two steps are used for setting the Prometheus target, which would export some time-series\ndata for the incoming queries.")]),a._v(" "),t("p",[a._v("Prometheus can be started by Docker with custom configuration files.")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker run                                                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v(":9090                                              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -v /path/to/prometheus.yml:/etc/prometheus/prometheus.yml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        prom/prometheus\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("The configuration files must\ninclude the configurations for using HStream Metrics Exporter as target and scrape intervals. Check\nthe "),t("a",{attrs:{href:"https://prometheus.io/docs/prometheus/latest/getting_started/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Prometheus guide"),t("OutboundLink")],1),a._v(" for details.\nThe server URL option (which have a default value) of the HStream Metrics Exporter set during the\nprevious step would be used in the Prometheus configuration.")]),a._v(" "),t("p",[a._v("The above steps are used for setting data sources for Grafana, which would be used in making data\nvisualizations such as Grafana dashboards.")]),a._v(" "),t("p",[a._v("To install and run Grafana using Docker, take the open-source version as an example.")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("docker run                              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":3000                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GF_AUTH_ANONYMOUS_ORG_ROLE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Admin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GF_AUTH_ANONYMOUS_ENABLED")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GF_AUTH_DISABLE_LOGIN_FORM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        grafana/grafana-oss\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("Here are a few options making "),t("strong",[a._v("just having a preview")]),a._v(" of monitoring HStreamDB easier.")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("GF_AUTH_ANONYMOUS_ORG_ROLE=Admin")]),a._v(": enable anonymous organization as Grafana admin, which is able\nto add data sources")]),a._v(" "),t("li",[t("code",[a._v("GF_AUTH_ANONYMOUS_ENABLED=true")]),a._v(": enable and use an anonymous organization as default organization")]),a._v(" "),t("li",[t("code",[a._v("GF_AUTH_DISABLE_LOGIN_FORM=true")]),a._v(": make the above two options work, in addition, skip log in\nscreen")])]),a._v(" "),t("h3",{attrs:{id:"provisioning-grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#provisioning-grafana"}},[a._v("#")]),a._v(" Provisioning Grafana")]),a._v(" "),t("p",[a._v("The provisioning settings consist of two steps:")]),a._v(" "),t("ul",[t("li",[a._v("First, set the Grafana data sources")]),a._v(" "),t("li",[a._v("Second, set the Grafana dashboards")])]),a._v(" "),t("p",[a._v("To start with, create a folder with the following hierarchy:")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("provisioning/\n├── dashboards/\n└── datasources/\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("To use with Docker, add the option "),t("code",[a._v("<path-to>/provisioning:/etc/grafana/provisioning")]),a._v(" to Docker\noptions.")]),a._v(" "),t("p",[a._v("In the "),t("code",[a._v("dashboards")]),a._v(" folder, a file named "),t("code",[a._v("dashboards.yml")]),a._v(" must be used for set up provisioning\ndata sources. An example would be like:")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("datasources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Prometheus\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("uid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" TNX2D3rnk\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("orgId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" prometheus\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("typeName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Prometheus\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("typeLogoUrl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" public/app/plugins/datasource/prometheus/img/prometheus_logo.svg\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" proxy\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("database")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("basicAuth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("isDefault")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("jsonData")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("httpMethod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" POST\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("readOnly")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br")])]),t("p",[a._v("In the "),t("code",[a._v("dashboards")]),a._v(" folder, a file named "),t("code",[a._v("dashboards.yml")]),a._v(" must be used for set up provisioning\ndashboards. An example would be like:")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("providers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"DS_PROMETHEUS"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("orgId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("folder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" file\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("disableDeletion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("updateIntervalSeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("allowUiUpdates")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("options")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/grafana/provisioning/dashboards\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("foldersFromFilesStructure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br")])]),t("p",[a._v("The "),t("code",[a._v("path")]),a._v(" field here is corresponding to the path in Docker options which had been bind to,\nnamely "),t("code",[a._v("/etc/grafana/provisioning")]),a._v(". Grafana will treat all JSON files in the "),t("code",[a._v("path")]),a._v(" folder as\ndashboards which would be imported on start up. The JSON format dashboards can be export from\ncreated dashboards.")]),a._v(" "),t("h3",{attrs:{id:"query-metrics-and-create-dashboards-with-grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#query-metrics-and-create-dashboards-with-grafana"}},[a._v("#")]),a._v(" Query Metrics and Create Dashboards with Grafana")]),a._v(" "),t("p",[a._v("With the above required services started, one can do metrics queries and visualise data with\nGrafana.")]),a._v(" "),t("p",[a._v("The following creates a new metrics panel on the Dashboards tab:")]),a._v(" "),t("p",[a._v('Click on "Add panel":')]),a._v(" "),t("p",[t("img",{attrs:{src:e(459),alt:""}})]),a._v(" "),t("p",[a._v('Click on "Add a new panel":')]),a._v(" "),t("p",[t("img",{attrs:{src:e(460),alt:""}})]),a._v(" "),t("p",[a._v('Under the "Query" tab, use the metrics explorer under the "Metrics" tab to select the HStream\nmetrics. Use the query builder to construct the query, and edit the title and more attributes. Then\nsave the new panel.')]),a._v(" "),t("p",[t("img",{attrs:{src:e(461),alt:""}})]),a._v(" "),t("p",[a._v('Click on "Save dashboard", then export as JSON for provisioning and import usages.')]),a._v(" "),t("p",[t("img",{attrs:{src:e(462),alt:""}})])])}),[],!1,null,null,null);s.default=n.exports}}]);