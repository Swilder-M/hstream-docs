(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{493:function(s,e,t){"use strict";t.r(e);var a=t(11),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"running-on-kubernetes-by-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#running-on-kubernetes-by-helm"}},[s._v("#")]),s._v(" Running on Kubernetes by Helm")]),s._v(" "),t("p",[s._v("This document describes how to run HStreamDB kubernetes using the helm chart that we\nprovide. The document assumes basic previous kubernetes knowledge. By the end of\nthis section, you'll have a fully running HStreamDB cluster on kubernetes that's\nready to receive reads/writes, process datas, etc.")]),s._v(" "),t("h2",{attrs:{id:"building-your-kubernetes-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#building-your-kubernetes-cluster"}},[s._v("#")]),s._v(" Building your Kubernetes Cluster")]),s._v(" "),t("p",[s._v("The first step is to have a running kubernetes cluster. You can use a managed\ncluster (provided by your cloud provider), a self-hosted cluster or a local\nkubernetes cluster using a tool like minikube. Make sure that kubectl points to\nwhatever cluster you're planning to use.")]),s._v(" "),t("p",[s._v("Also, you need a storageClass, you can create by "),t("code",[s._v("kubectl")]),s._v("or by your cloud provider web page if it has. minikube provides a storage class called "),t("code",[s._v("standard")]),s._v(" by default, which is used by the helm chart by default.")]),s._v(" "),t("h2",{attrs:{id:"starting-hstreamdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#starting-hstreamdb"}},[s._v("#")]),s._v(" Starting HStreamDB")]),s._v(" "),t("h3",{attrs:{id:"clone-code-and-get-helm-dependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clone-code-and-get-helm-dependencies"}},[s._v("#")]),s._v(" Clone code and get helm dependencies")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/hstreamdb/hstream.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" hstream/deploy/chart/hstream/\nhelm dependency build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"deploy-hstreamdb-by-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-hstreamdb-by-helm"}},[s._v("#")]),s._v(" Deploy HStreamDB by Helm")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" my-hstream "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Helm chart also provides the "),t("code",[s._v("value.yaml")]),s._v(" file where you can modify your configuration, for example when you want to use other storage classes to deploy the cluster, you can modify "),t("code",[s._v("logdevice.persistence.storageClass")]),s._v(" and "),t("code",[s._v("zookeeper.persistence.storageClass")]),s._v(" in "),t("code",[s._v("value.yaml")]),s._v(", and use "),t("code",[s._v("helm install my-hstream -f values.yaml .")]),s._v(" to deploy.")]),s._v(" "),t("h3",{attrs:{id:"check-cluster-status"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-cluster-status"}},[s._v("#")]),s._v(" Check Cluster status")]),s._v(" "),t("p",[s._v("The "),t("code",[s._v("helm install")]),s._v(" command will deploy the zookeeper cluster, logdevice cluster and hstream cluster, this can take some time, you can check the status of the cluster with "),t("code",[s._v("kubectl get pods")]),s._v(", there will be some "),t("code",[s._v("Error")]),s._v(" and "),t("code",[s._v("CrashLoopBackOff")]),s._v(" status during the cluster deployment, these will disappear after some time, eventually you will see something like the following.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NAME                                                 READY   STATUS    RESTARTS      AGE\nmy-hstream-0                                         1/1     Running   3 (16h ago)   16h\nmy-hstream-1                                         1/1     Running   2 (16h ago)   16h\nmy-hstream-2                                         1/1     Running   0             16h\nmy-hstream-logdevice-0                               1/1     Running   3 (16h ago)   16h\nmy-hstream-logdevice-1                               1/1     Running   3 (16h ago)   16h\nmy-hstream-logdevice-2                               1/1     Running   0             16h\nmy-hstream-logdevice-3                               1/1     Running   0             16h\nmy-hstream-logdevice-admin-server-6867fd9494-bk5mf   1/1     Running   3 (16h ago)   16h\nmy-hstream-zookeeper-0                               1/1     Running   0             16h\nmy-hstream-zookeeper-1                               1/1     Running   0             16h\nmy-hstream-zookeeper-2                               1/1     Running   0             16h\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("You can check the status of the HStreamDB cluster with the "),t("code",[s._v("hadmin server")]),s._v(" command.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('kubectl exec -it hstream-1 -- bash -c "hadmin server status"\n+---------+---------+------------------+\n| node_id |  state  |     address      |\n+---------+---------+------------------+\n| 100     | Running | 172.17.0.4:6570  |\n| 101     | Running | 172.17.0.10:6570 |\n| 102     | Running | 172.17.0.12:6570 |\n+---------+---------+------------------+\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"manage-hstore-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manage-hstore-cluster"}},[s._v("#")]),s._v(" Manage HStore Cluster")]),s._v(" "),t("p",[s._v("Now you can run "),t("code",[s._v("hadmin store")]),s._v(" to manage the hstore cluster:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('kubectl exec -it my-hstream-0 -- bash -c "hadmin store --help"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("To check the state of the cluster, you can then run:")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it my-hstream-0 -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hadmin store --host my-hstream-logdevice-admin-server status"')]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     NAME               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PACKAGE  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    UPTIME    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LOCATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ALIVE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n+---------+-------------+---------------+------------+---------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  SEQ.   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DATA HEALTH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" STORAGE STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SHARD OP.  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTH STATUS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-------------+---------------+------------+---------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-------------+---------------+------------+---------------+\nTook "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".727s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);