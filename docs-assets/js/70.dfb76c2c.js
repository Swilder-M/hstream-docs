(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{540:function(s,a,t){"use strict";t.r(a);var e=t(11),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"在-kubernetes-上通过-helm-部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-kubernetes-上通过-helm-部署"}},[s._v("#")]),s._v(" 在 Kubernetes 上通过 helm 部署")]),s._v(" "),t("p",[s._v("本文档描述了如何使用我们提供的 helm chart 来运行 HStreamDB kubernetes。该文档假设读者\n有基本的 kubernetes 知识。在本节结束时，你将拥有一个完全运行在 kubernetes 上的\nHStreamDB 集群，它已经准备就绪，可以接收读/写，处理数据，等等。")]),s._v(" "),t("h2",{attrs:{id:"建立你的-kubernetes-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建立你的-kubernetes-集群"}},[s._v("#")]),s._v(" 建立你的 Kubernetes 集群")]),s._v(" "),t("p",[s._v("第一步是要有一个正在运行的 kubernetes 集群。你可以使用一个托管的集群（由你的云提\n供商提供），一个自我托管的集群或一个本地的 kubernetes 集群，比如 minikube。请确\n保 kubectl 指向你计划使用的任何集群。")]),s._v(" "),t("p",[s._v('另外，你需要一个存储类，你可以通过 "kubectl "创建。或者通过你的云服务提供商的网页来创建，如果它有的话。\nminikube 默认提供一个名为 '),t("code",[s._v("standard")]),s._v(" 的存储类，helm chart 默认使用此存储类。")]),s._v(" "),t("h2",{attrs:{id:"通过-helm-部署-hstreamdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过-helm-部署-hstreamdb"}},[s._v("#")]),s._v(" 通过 Helm 部署 HStreamDB")]),s._v(" "),t("h3",{attrs:{id:"clone-代码并获取-helm-依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clone-代码并获取-helm-依赖"}},[s._v("#")]),s._v(" Clone 代码并获取 helm 依赖")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/hstreamdb/hstream.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" hstream/deploy/chart/hstream/\nhelm dependency build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"通过-helm-部署-hstreamdb-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过-helm-部署-hstreamdb-2"}},[s._v("#")]),s._v(" 通过 Helm 部署 HStreamDB")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" my-hstream "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Helm chart 还提供了 "),t("code",[s._v("value.yaml")]),s._v(" 文件，你可以在这个文件中修改你的配置,比如当你希望使用其他的存储类来部署集群时，你可以修改 "),t("code",[s._v("value.yaml")]),s._v(" 中的 "),t("code",[s._v("logdevice.persistence.storageClass")]),s._v(" 和 "),t("code",[s._v("zookeeper.persistence.storageClass")]),s._v("，并使用 "),t("code",[s._v("helm install my-hstream -f values.yaml .")]),s._v(" 来署。")]),s._v(" "),t("h3",{attrs:{id:"检查集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查集群状态"}},[s._v("#")]),s._v(" 检查集群状态")]),s._v(" "),t("p",[t("code",[s._v("helm install")]),s._v(" 命令会部署 zookeeper 集群、logdevice 集群和 hstream 集群，这可能会花费一定的时间，你可以通过 "),t("code",[s._v("kubectl get pods")]),s._v(" 来检查集群的状况，在集群部署的过程中，会有一些 "),t("code",[s._v("Error")]),s._v(" 和 "),t("code",[s._v("CrashLoopBackOff")]),s._v(" 的状态，这些状态会在一定时间后消失，最终你会看到类似如下的内容：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NAME                                                 READY   STATUS    RESTARTS      AGE\nmy-hstream-0                                         1/1     Running   3 (16h ago)   16h\nmy-hstream-1                                         1/1     Running   2 (16h ago)   16h\nmy-hstream-2                                         1/1     Running   0             16h\nmy-hstream-logdevice-0                               1/1     Running   3 (16h ago)   16h\nmy-hstream-logdevice-1                               1/1     Running   3 (16h ago)   16h\nmy-hstream-logdevice-2                               1/1     Running   0             16h\nmy-hstream-logdevice-3                               1/1     Running   0             16h\nmy-hstream-logdevice-admin-server-6867fd9494-bk5mf   1/1     Running   3 (16h ago)   16h\nmy-hstream-zookeeper-0                               1/1     Running   0             16h\nmy-hstream-zookeeper-1                               1/1     Running   0             16h\nmy-hstream-zookeeper-2                               1/1     Running   0             16h\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("你可以通过 "),t("code",[s._v("hadmin server")]),s._v(" 命令来检查 HStreamDB 集群的状态。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('kubectl exec -it hstream-1 -- bash -c "hadmin server status"\n+---------+---------+------------------+\n| node_id |  state  |     address      |\n+---------+---------+------------------+\n| 100     | Running | 172.17.0.4:6570  |\n| 101     | Running | 172.17.0.10:6570 |\n| 102     | Running | 172.17.0.12:6570 |\n+---------+---------+------------------+\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"管理存储集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理存储集群"}},[s._v("#")]),s._v(" 管理存储集群")]),s._v(" "),t("p",[s._v("现在你可以运行 "),t("code",[s._v("hadmin store")]),s._v(" "),t("strong",[s._v("来管理这个集群")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('kubectl exec -it my-hstream-0 -- bash -c "hadmin store --help"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("要检查 store 集群的状态，你可以运行：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it my-hstream-0 -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hadmin store --host my-hstream-logdevice-admin-server status"')]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        NAME            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PACKAGE  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    UPTIME    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LOCATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ALIVE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" my-hstream-logdevice-3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.99")]),s._v(".99 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DEAD  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+------------------------+----------+-------+--------------+----------+\n+---------+-------------+---------------+------------+---------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  SEQ.   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" DATA HEALTH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" STORAGE STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SHARD OP.  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTH STATUS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-------------+---------------+------------+---------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" READ_WRITE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ENABLED"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" HEALTHY       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------+-------------+---------------+------------+---------------+\nTook "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(".727s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);