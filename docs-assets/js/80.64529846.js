(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{553:function(s,t,e){"use strict";e.r(t);var n=e(11),a=Object(n.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"quick-deployment-with-docker-and-ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#quick-deployment-with-docker-and-ssh"}},[s._v("#")]),s._v(" Quick Deployment with Docker and SSH")]),s._v(" "),e("p",[s._v("This document provides a way to start an HStreamDB cluster quickly using Docker\nand SSH.")]),s._v(" "),e("h2",{attrs:{id:"pre-require"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pre-require"}},[s._v("#")]),s._v(" Pre-Require")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("The local host needs to be able to connect to the remote server via SSH")])]),s._v(" "),e("li",[e("p",[s._v("Using SSH Config File to help remote connect")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://linuxize.com/post/using-the-ssh-config-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Reference"),e("OutboundLink")],1)])])]),s._v(" "),e("li",[e("p",[s._v("Remote server has docker installed")])])]),s._v(" "),e("h2",{attrs:{id:"fetching-the-startup-script"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fetching-the-startup-script"}},[s._v("#")]),s._v(" Fetching the Startup Script")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" script\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O script/dev-deploy https://raw.githubusercontent.com/hstreamdb/hstream/main/script/dev-deploy\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O script/dev_deploy_conf_example.json https://raw.githubusercontent.com/hstreamdb/hstream/main/script/dev_deploy_conf_example.json\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"create-a-configuration-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-configuration-file"}},[s._v("#")]),s._v(" Create a Configuration File")]),s._v(" "),e("p",[s._v("Create a JSON-format config file to fit your situation. There is an example in\n"),e("code",[s._v("script/dev_deploy_conf_example.json")]),s._v(".")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host1"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.1"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.2"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.3"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.4"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zookeeper"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistent-dir"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/zookeeper"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enable-metrics-provider"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstore"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"image"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstreamdb/hstream:v0.9.0"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistent-dir"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/store"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local_config_path"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('/logdevice.conf"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_config_path"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/.config/dev-deploy/logdevice.conf"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstore-admin"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"image"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstreamdb/hstream:v0.9.0"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1024m"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpus"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.5"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host1"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hserver"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"image"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstreamdb/hstream:v0.9.0"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"memory"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2048m"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpus"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.5"')]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(",\n            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br")])]),e("p",[s._v("The "),e("code",[s._v("hosts")]),s._v(" field stores remote server information in the form of key-value\npairs. The key is the hostname of the server in the SSH configuration file and\nthe value is the IP address of the server.")]),s._v(" "),e("p",[s._v("The field "),e("code",[s._v("hosts")]),s._v(", among other top-level configuration field objects which each\nis about a service kind, is required in the configuration file. Other fields\nare: "),e("code",[s._v("zookeeper")]),s._v(", "),e("code",[s._v("hstore")]),s._v(", "),e("code",[s._v("hstore-admin")]),s._v(" and "),e("code",[s._v("hserver")]),s._v(". The configuration file\nalso supports filling in configuration items related to monitoring components\n(such as prometheus, grafana, etc.), which are not core components and are not\ndescribed here.")]),s._v(" "),e("p",[s._v("The HStore configuration must be set before deployment. The path of config is\nstored in the field "),e("code",[s._v("hstore.local_config_path")]),s._v(" and "),e("code",[s._v("hstore.remote_config_path")]),s._v(",\nrespectively. The former is the path to the HStore config file on the local\nmachine which is to run the deployment script, while the latter is the\ndestination that the HStore config file would be uploaded to during deployment.\nYou can refer to the "),e("code",[s._v("Create a configuration file")]),s._v(" section in the documentation\n"),e("RouterLink",{attrs:{to:"/zh/latest/deployment/deploy-docker.html"}},[s._v("Manual Deployment with Docker")]),s._v(" to create an HStore config\nfile.")],1),s._v(" "),e("p",[s._v("The configuration of HServers is configured with the field\n"),e("code",[s._v("hstore.local_config_path")]),s._v(" and "),e("code",[s._v("hstore.remote_config_path")]),s._v(". You can refer to the\ndocumentation "),e("RouterLink",{attrs:{to:"/zh/latest/reference/config.html"}},[s._v("HStreamDB Configuration")]),s._v(" for details.\nThis is optional and if the value is not filled in, the default configuration\nwill be used to start.")],1),s._v(" "),e("p",[s._v("Each JSON object for configuring a kind of service has a field named "),e("code",[s._v("hosts")]),s._v("\nwhich indicates which server nodes are used to start corresponding service\ninstances.")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("Check the ZooKeeper related fields in the HStore config file to make")]),s._v(" "),e("p",[s._v("sure that the ZooKeeper nodes information is consistent.")])]),s._v(" "),e("p",[s._v("Each JSON object for configuring a kind of service also had some extra optional\nfields for configuring the resource constraints of containers used by this kind\nof service, such as "),e("code",[s._v("memory")]),s._v(" and "),e("code",[s._v("cpus")]),s._v(". The usages of the above two are\nanalogous the ones in the\n"),e("a",{attrs:{href:"https://docs.docker.com/config/containers/resource_constraints/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker options"),e("OutboundLink")],1),s._v(".")]),s._v(" "),e("h2",{attrs:{id:"cluster-management"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cluster-management"}},[s._v("#")]),s._v(" Cluster Management")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("After creating the configuration file, you can start/stop a hstreamdb cluster\nwith these commands")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start cluster")]),s._v("\ndev-deploy --remote "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path start\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# stop cluster: just stop containers")]),s._v("\ndev-deploy --remote "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path stop\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remove cluster: stop containers and delete persistent data")]),s._v("\ndev-deploy --remote "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path remove\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])])])])}),[],!1,null,null,null);t.default=a.exports}}]);